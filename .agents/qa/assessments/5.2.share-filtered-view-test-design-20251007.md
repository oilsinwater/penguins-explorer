# Test Design: Story 5.2

Date: 2025-10-07
Designer: Quinn (Test Architect)

## Test Strategy Overview

- Total test scenarios: 18
- Unit tests: 8 (44%)
- Integration tests: 6 (33%)
- E2E tests: 4 (22%)
- Priority distribution: P0: 6, P1: 8, P2: 4

## Test Scenarios by Acceptance Criteria

### AC1: URL structure: /visualize/[chartType]?[filters]

#### Scenarios

| ID           | Level       | Priority | Test                              | Justification            |
| ------------ | ----------- | -------- | --------------------------------- | ------------------------ |
| 5.2-UNIT-001 | Unit        | P0       | serializeToURL formats correctly  | Pure serialization logic |
| 5.2-UNIT-002 | Unit        | P0       | hydrateFromURL parses parameters  | Pure parsing logic       |
| 5.2-UNIT-003 | Unit        | P1       | validateAndNormalizeURL sanitizes | Input validation logic   |
| 5.2-INT-001  | Integration | P0       | URL sync updates FilterStore      | Hook-state interaction   |
| 5.2-INT-002  | Integration | P1       | Browser navigation updates state  | Browser API integration  |

### AC2: Copy URL button with confirmation

#### Scenarios

| ID           | Level | Priority | Test                             | Justification                   |
| ------------ | ----- | -------- | -------------------------------- | ------------------------------- |
| 5.2-UNIT-004 | Unit  | P0       | ShareButton.click copies URL     | Component logic + clipboard API |
| 5.2-UNIT-005 | Unit  | P1       | Fallback to execCommand          | Browser compatibility logic     |
| 5.2-UNIT-006 | Unit  | P1       | Toast shows on successful copy   | UI state change                 |
| 5.2-E2E-001  | E2E   | P0       | User clicks share and copies URL | Critical user journey           |
| 5.2-E2E-002  | E2E   | P1       | Copy fails gracefully on HTTP    | Error handling in real context  |

### AC3: Loading shared URL restores exact state

#### Scenarios

| ID          | Level       | Priority | Test                              | Justification                   |
| ----------- | ----------- | -------- | --------------------------------- | ------------------------------- |
| 5.2-INT-003 | Integration | P0       | Direct URL load restores filters  | Multiple component coordination |
| 5.2-INT-004 | Integration | P1       | Back/forward navigation preserves | Browser history integration     |
| 5.2-INT-005 | Integration | P2       | Invalid params show defaults      | Error handling flow             |
| 5.2-E2E-003 | E2E         | P0       | Full URL share workflow           | End-to-end validation           |

### AC4: Social sharing preview metadata

#### Scenarios

| ID           | Level | Priority | Test                              | Justification              |
| ------------ | ----- | -------- | --------------------------------- | -------------------------- |
| 5.2-UNIT-007 | Unit  | P2       | Meta tags render correctly        | DOM manipulation           |
| 5.2-UNIT-008 | Unit  | P2       | OG image URL is absolute          | URL formatting logic       |
| 5.2-E2E-004  | E2E   | P2       | Social preview renders externally | External system validation |

## Risk Coverage

| Risk ID  | Mitigated By              |
| -------- | ------------------------- |
| TECH-001 | 5.2-UNIT-005, 5.2-E2E-002 |
| TECH-002 | 5.2-UNIT-003, 5.2-INT-005 |
| TECH-003 | 5.2-INT-004               |
| SEC-001  | 5.2-UNIT-003              |
| OPS-001  | 5.2-UNIT-008, 5.2-E2E-004 |

## Recommended Execution Order

1. P0 Unit tests (fail fast)
   - 5.2-UNIT-001, 5.2-UNIT-002, 5.2-UNIT-004
2. P0 Integration tests
   - 5.2-INT-001, 5.2-INT-003
3. P0 E2E tests
   - 5.2-E2E-001, 5.2-E2E-003
4. P1 tests in order
   - Remaining P1 scenarios
5. P2 tests as time permits
   - Social preview tests

## Test Data Requirements

### URL Parameters

- Valid combinations: chart types + filters
- Edge cases: empty params, malformed values
- Security: XSS payloads, URL encoding

### Browser Contexts

- HTTPS environment (Clipboard API available)
- HTTP environment (fallback required)
- Different browsers (Chrome, Firefox, Safari)

## Coverage Gaps

None identified - all ACs have adequate test coverage.

## Accessibility Tests

| ID           | Test                             | Level       |
| ------------ | -------------------------------- | ----------- |
| 5.2-A11Y-001 | ShareButton keyboard navigation  | Integration |
| 5.2-A11Y-002 | Toast notification screen reader | E2E         |
| 5.2-A11Y-003 | Focus indicators on share button | Unit        |

## Performance Tests

| ID           | Test                            | Level       |
| ------------ | ------------------------------- | ----------- |
| 5.2-PERF-001 | URL sync debouncing performance | Integration |
| 5.2-PERF-002 | Large URL parameter handling    | Unit        |
