# Test Design: Story 2.4 - Clear All Filters

## Overview

This test design provides comprehensive coverage for the "Clear All Filters" feature, ensuring reliable reset functionality, proper UI feedback, state synchronization, and accessibility. Tests are distributed across levels: unit (component isolation), integration (state/URL interactions), and E2E (user flows). Total scenarios: 12 (100% AC coverage). Priorities: P0 (critical path, 6 scenarios), P1 (UI/a11y, 4), P2 (edge cases, 2).

**Risk-Based Focus:** Emphasize reset reliability (STATE-001) and announcements (A11Y-001) from risk assessment. All P0 scenarios must pass for gate PASS.

## AC Coverage Mapping

- AC1 (Button visibility/count): Scenarios 1-3, 7-8
- AC2 (Active count): Scenarios 2, 4
- AC3 (Reset): Scenarios 5-6, 9-10
- AC4 (Announcements): Scenarios 11-12

## Test Scenarios by Level

### Unit Tests (Vitest + RTL) - 5 Scenarios

Focus: Isolated component behavior, no external deps.

1. **P0: Button renders when filters active** (AC1)

   - Given: Mock Context with active filters (e.g., selectedSpecies=['Adelie'])
   - When: Render FiltersPanel
   - Then: Clear button visible, text "Clear 1 filter(s)"

2. **P0: Button hidden when no filters active** (AC1)

   - Given: Mock Context with defaults (all filters cleared)
   - When: Render FiltersPanel
   - Then: Clear button not visible

3. **P1: Count updates dynamically** (AC2)

   - Given: Mock state changes (add/remove filters)
   - When: Re-render with updated props
   - Then: Button text reflects exact count (e.g., "Clear 3 filters")

4. **P1: Button click dispatches reset** (AC3)

   - Given: Mock dispatch
   - When: Click clear button
   - Then: Dispatches CLEAR_ALL_FILTERS with correct payload (species=[], island='all', sex='all')

5. **P2: Icon and styling consistent** (AC1)
   - Given: Rendered button
   - When: Inspect element
   - Then: Contains ClearIcon, MUI secondary theme, min 44x44px

**Files:** `tests/unit/components/FiltersPanel.test.tsx`

### Integration Tests (Cypress Component) - 4 Scenarios

Focus: Component + Context API/URL sync.

6. **P0: Reset clears state and URL** (AC3)

   - Given: Active filters (species=Adelie, island=Biscoe, URL ?species=Adelie&island=Biscoe)
   - When: Click clear button
   - Then: State resets to defaults, URL to /penguins (no params), table shows full dataset

7. **P1: Count accurate across filter types** (AC2)

   - Given: Mix active (2 species + 1 island + 1 sex)
   - When: Render panel
   - Then: Button shows "Clear 4 filters"

8. **P1: Reset integrates with existing filters** (AC3)

   - Given: All filters active from previous stories
   - When: Click clear
   - Then: All reset (species all, island 'all', sex 'all'); no conflicts

9. **P2: Error handling on dispatch failure** (AC3)
   - Given: Mock dispatch error
   - When: Click clear
   - Then: Graceful fallback (button disabled briefly), console warning logged

**Files:** `tests/integration/filters/ClearFilters.cy.tsx`

### E2E Tests (Cypress) - 3 Scenarios

Focus: Full user flow, browser interactions.

10. **P0: End-to-end reset flow** (AC3)

    - Given: Navigate to /penguins, activate multiple filters
    - When: Click clear button
    - Then: Table/charts reset to full dataset, URL cleared, no errors

11. **P1: Keyboard activation** (AC3 + AC4)

    - Given: Filters active, focus on button (Tab navigation)
    - When: Press Enter/Space on button
    - Then: Resets state/URL, screen reader announces "All filters cleared"

12. **P1: Accessibility validation** (AC4)
    - Given: Rendered page with active filters
    - When: Run axe-core scan on clear action
    - Then: No WCAG violations; aria-live announces correctly (manual NVDA/VoiceOver check)

**Files:** `cypress/e2e/user-flows/filtering.cy.ts` (extend existing)

## Priority Distribution

- **P0 (Critical - Core Functionality):** 6 scenarios (reset logic, state/URL sync, E2E flow) – Must pass for release.
- **P1 (Important - UI/A11y):** 4 scenarios (visibility, count, keyboard, announcements) – High coverage required.
- **P2 (Edge/Optional):** 2 scenarios (styling, error handling) – Nice-to-have.

## Test Data & Setup

- Use existing penguins.json; add mocks for multi-filter states (e.g., { selectedSpecies: ['Adelie'], selectedIsland: 'Biscoe', selectedSex: 'male' }).
- Dev server required for Cypress (npm run dev).
- Axe-core plugin for a11y scans.

## Coverage Summary

- **AC Coverage:** 100% (All 4 ACs mapped to multiple scenarios).
- **Risk Coverage:** 100% (STATE-001, A11Y-001 addressed in P0/P1).
- **NFRs:** Performance (reset <100ms), Reliability (no crashes), Maintainability (tests for future filters).
- **Gaps:** None critical; monitor if new filters added post-Epic 2.

**Designer:** Quinn (Test Architect)  
**Date:** 2025-09-11  
**Estimated Effort:** 4-6 hours (leverages existing patterns).
