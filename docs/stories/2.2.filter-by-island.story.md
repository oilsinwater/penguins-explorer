# Story 2.2: Filter by Island

## Status

Draft

## Story

**As a** user,  
**I want** to filter by island,  
**so that** I can focus on penguins from specific islands in the dataset.

## Acceptance Criteria

1. Dropdown/select with options: All, Biscoe, Dream, Torgersen
2. "All" selected by default
3. Instant filtering on selection
4. Clear visual feedback of active filter

## Tasks / Subtasks

- [ ] **Task 1: Implement Island Filter Component** (AC: 1, 2, 4)
  - [ ] Create `src/components/filters/IslandFilter.tsx`
  - [ ] Implement MUI Select dropdown with island options
  - [ ] Set "All" as default selection
  - [ ] Add visual feedback for active filter (e.g., label with selected value)

- [ ] **Task 2: Connect Filter to State Management** (AC: 2, 3)
  - [ ] Update Context API in `src/context/actions.ts` for island filter state
  - [ ] Integrate with existing filter state from SpeciesFilter
  - [ ] Add URL persistence using TanStack Router for island parameter

- [ ] **Task 3: Apply Filtering Logic** (AC: 3)
  - [ ] Extend `src/utils/filtering.ts` to include island filtering
  - [ ] Ensure real-time updates to table and visualizations
  - [ ] Handle "All" option to show unfiltered data for island

- [ ] **Task 4: Testing Implementation** (AC: All)
  - [ ] Write Vitest unit tests for dropdown interactions in `tests/unit/components/filters/IslandFilter.test.tsx`
  - [ ] Write Cypress integration tests for filter synchronization in `tests/integration/filters/IslandFilter.cy.tsx`
  - [ ] Test URL state persistence and instant filtering in E2E tests
  - [ ] Validate accessibility with axe-core for keyboard navigation and ARIA labels

## Dev Notes

### Previous Story Insights

**Source: [docs/stories/2.1.filter-by-species.story.md#completion-notes]**

- Use Context API for global filter state management
- URL state persistence via TanStack Router works for multi-filter scenarios
- Filtering logic in `src/utils/filtering.ts` handles real-time updates efficiently
- Vitest and Cypress testing patterns established for filters

### UI Component Specifications

**Source: [docs/architecture/tech-stack.md#ui-framework]**

- Use MUI v5 Select component (@mui/material) for dropdown
- Emotion CSS-in-JS for styling
- MUI theme system for consistent design tokens
- Ensure WCAG 2.1 AA compliance with keyboard navigation and ARIA labels

### State Management Requirements

**Source: [docs/architecture/tech-stack.md#state-management]**

- Context API for global app state including filters
- Memoized selectors for performance in `src/context/selectors.ts`
- Integrate with existing filter state without conflicts

### Routing Integration

**Source: [docs/architecture/tech-stack.md#routing]**

- TanStack Router for URL state: Add `island` parameter (e.g., ?island=biscoe)
- Bidirectional sync: URL changes update state, state changes update URL

### File Structure Requirements

**Source: [docs/architecture/source-tree.md]**

```
src/
└── components/
    └── filters/
        └── IslandFilter.tsx  # MUI Select with island options and styling
```

Update `FilterPanel.tsx` to include IslandFilter alongside SpeciesFilter

### Testing Requirements

**Source: [docs/architecture/testing-strategy.md]**

- **Unit Tests**: Vitest + React Testing Library in `tests/unit/components/filters/IslandFilter.test.tsx`
- **Integration Tests**: Cypress in `tests/integration/filters/IslandFilter.cy.tsx`
- **E2E Tests**: Cypress in `tests/e2e/user-flows/filtering.cy.ts`
- Coverage: Dropdown selection, URL sync, data updates, accessibility
- Test Data: Penguins distributed across islands (Biscoe: 168, Dream: 124, Torgersen: 52)

### Accessibility Requirements

**Source: [docs/architecture/tech-stack.md#accessibility]**

- WCAG 2.1 AA: Keyboard navigable dropdown
- ARIA labels for screen reader announcements on selection change
- Focus management for Select component

### Performance Considerations

**Source: [docs/architecture/tech-stack.md#performance]**

- Memoization for filter computations
- Debounced URL updates if needed for rapid selections

## Change Log

| Date       | Version | Description                  | Author             |
| ---------- | ------- | ---------------------------- | ------------------ |
| 2025-09-10 | 1.0     | Story created from PRD US2.2 | Bob (Scrum Master) |

## Dev Agent Record

### Agent Model Used

_To be filled by Dev Agent_

### Debug Log References

_To be filled by Dev Agent_

### Completion Notes List

_To be filled by Dev Agent_

### File List

_To be filled by Dev Agent_

## QA Results

### Review Date: 2025-09-10

### Reviewed By: Quinn (Test Architect)

**Quality Assessment Summary:**

Story 2.2 demonstrates robust technical foundation with complete architecture alignment and thorough test coverage. Risk assessment identified 5 total risks (1 medium accessibility, 4 low technical) with manageable impact on implementation.

**Key Findings:**
- Strong alignment with PRD requirements and architecture standards (tech-stack.md, source-tree.md)
- Comprehensive test matrix (100% AC coverage with 12 scenarios across unit/integration/E2E)
- Established patterns from Story 2.1 properly extended (Context API, URL sync)
- WCAG 2.1 AA compliance addressed via axe-core testing plan

**Risk Profile:**
- Risk Score: 95/100 (Low - Minor accessibility considerations)
- Primary Concern: Keyboard navigation for MUI Select (mitigated via Test Design)

**Readiness Assessment:**
Story provides complete context for development with precise technical guidance and actionable tasks. Implementation risks are well-mitigated through established patterns and comprehensive test plan.

### Gate Status

Gate: PASS → docs/qa/gates/2.2.filter-by-island.yml
Risk profile: docs/qa/assessments/2.2.filter-by-island-risk-20250910.md
Test design: docs/qa/assessments/2.2.filter-by-island-test-design-20250910.md
