# Story 5.2: Share Filtered View

## Status
Draft

## Story
**As a** user,  
**I want** to share my filtered view,  
**so that** others can see exactly what I'm analyzing.

## Acceptance Criteria

1. URL structure: /visualize/[chartType]?[filters] (e.g., /visualize/scatter?x=bill_length&y=body_mass)
2. Copy URL button with confirmation
3. Loading shared URL restores exact state
4. Social sharing preview metadata

## Tasks / Subtasks

- [ ] **Task 1: URL Structure Implementation** (AC: 1)
  - [ ] Implement URL routing for visualization views
  - [ ] Create URL parameter parsing for filters
  - [ ] Test URL structure with various chart types
  - [ ] Ensure backwards compatibility with existing URLs

- [ ] **Task 2: Copy URL Functionality** (AC: 2)
  - [ ] Add "Copy URL" button to filter panel
  - [ ] Implement clipboard copy functionality
  - [ ] Show confirmation message after copy
  - [ ] Ensure button accessibility

- [ ] **Task 3: State Restoration** (AC: 3)
  - [ ] Implement URL parameter parsing on page load
  - [ ] Restore filter states from URL parameters
  - [ ] Load correct chart type and configuration
  - [ ] Test state restoration accuracy

- [ ] **Task 4: Social Sharing Metadata** (AC: 4)
  - [ ] Add Open Graph meta tags for social sharing
  - [ ] Generate dynamic preview images
  - [ ] Include filter state in preview metadata
  - [ ] Test social sharing previews

- [ ] **Task 5: Testing Implementation**
  - [ ] Write Cypress tests for URL generation
  - [ ] Test state restoration from URLs
  - [ ] Verify copy URL functionality
  - [ ] Validate social sharing metadata

## Dev Notes

### URL Management
**Source: [architecture/tech-stack.md#state-management]**
- Use react-router for URL routing
- Serialize filter states to URL parameters
- Debounce URL updates for performance
- Handle URL decoding/encoding for special characters

### Sharing Requirements
**Source: [architecture/tech-stack.md#ui-framework]**
- Open Graph meta tags for social previews
- Dynamic image generation for previews
- Accessible copy button styling
- Keyboard navigation support

### Component Integration
**Source: [architecture/source-tree.md]**
- Routing: `src/routes/visualization.ts`
- URL utilities: `src/utils/url.ts`
- Sharing components: `src/components/Sharing.tsx`
- Test files: `src/sharing/-tests/`

### Testing Requirements
**Source: [architecture/testing-strategy.md]**
- Test file: `src/sharing/-tests/Share.cy.ts`
- Key scenarios:
  - URL generation accuracy
  - State restoration completeness
  - Copy URL functionality
  - Social sharing preview generation
  - Cross-browser URL handling
- Dependency: Requires completed filtering system and visualization components

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2024-09-04 | 1.0 | Created from PRD US5.2 | BMad SM |