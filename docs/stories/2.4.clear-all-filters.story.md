# Story 2.4: Clear All Filters

## Status

Draft

## Story

**As a** user,  
**I want** to clear all filters quickly,  
**so that** I can easily reset to see the full dataset.

## Acceptance Criteria

1. "Clear filters" button visible when any filter active
2. Shows count of active filters
3. Single click resets all filters
4. Announces action to screen readers

## Tasks / Subtasks

- [x] **Task 1: Implement Clear Filters Button** (AC: 1, 2)
  - [x] Add MUI Button to FiltersPanel in `src/components/FiltersPanel.tsx` [Source: architecture/component-architecture.md#filter-components]
  - [x] Show button only when filters active (use Context API state)
  - [x] Display active count (e.g., "Clear 2 filters") using Typography variant="caption"
  - [x] Style with MUI theme: secondary color, icon (ClearIcon from @mui/icons-material)

- [x] **Task 2: Connect Reset Logic to State Management** (AC: 3)
  - [x] Add CLEAR_ALL_FILTERS action in `src/context/actions.ts` to reset selectedSpecies=[], selectedIsland='all', selectedSex='all' [Source: architecture/state-management.md#filter-store]
  - [x] Dispatch action on button click from FiltersPanel
  - [x] Clear URL params via TanStack Router (remove species, island, sex) [Source: architecture/routing.md]
  - [x] Ensure real-time table/chart reset

- [x] **Task 3: Add Screen Reader Announcements** (AC: 4)
  - [x] Use MUI Alert or live region (aria-live="polite") to announce "All filters cleared" on reset
  - [x] Integrate with existing accessibility patterns from previous filters [Source: architecture/component-architecture.md#accessibility]

- [x] **Task 4: Testing Implementation** (AC: All)
  - [x] Unit tests for button visibility/count in Vitest (`tests/unit/components/FiltersPanel.test.tsx`) [Source: architecture/testing-strategy.md#unit-testing]
  - [x] Integration test for reset dispatch and URL clear in Cypress (`tests/integration/filters/ClearFilters.cy.tsx`)
  - [x] E2E test: Activate filters, click clear, verify full dataset reloads (`cypress/e2e/user-flows/filtering.cy.ts`)
  - [x] Accessibility test with axe-core for announcement

## Dev Notes

### Previous Story Insights

**Source: [docs/stories/2.3.filter-by-sex.story.md#completion-notes]**

- Context API manages multi-filter state reliably; reset must dispatch all UPDATE actions
- URL persistence via TanStack Router works; clear should remove all params
- MUI theme integration established; use consistent button styling
- Vitest/Cypress patterns for filters: Test state before/after reset
- Combined filtering supports reset to full dataset

### UI Component Specifications

**Source: [docs/architecture/component-architecture.md#filter-components]**

- Use MUI Button with ClearIcon for reset button
- Position in FiltersPanel header with conditional render
- Typography for count: variant="caption", color="textSecondary"
- Ensure WCAG 2.1 AA: Button size 44x44px min, focus outline

### State Management Requirements

**Source: [docs/architecture/state-management.md#filter-store]**

- Context API: Add CLEAR_ALL_FILTERS action resetting to defaults (species: all, island: 'all', sex: 'all')
- Dispatch multiple UPDATE actions or single reset reducer
- No conflicts with existing filters; test integration

### Routing Integration

**Source: [docs/architecture/routing.md]**

- TanStack Router: On reset, navigate to /penguins (clear query params)
- Bidirectional sync: State reset updates URL immediately

### File Structure Requirements

**Source: [docs/architecture/source-tree.md]**

```
src/
└── components/
    └── FiltersPanel.tsx  # Add Clear Button to existing panel
```

Update `src/pages/penguins/index.tsx` if panel is there (already includes filters)

### Testing Requirements

**Source: [docs/architecture/testing-strategy.md#ui-testing] + Previous Patterns**

- **Unit Tests**: Vitest + RTL in `tests/unit/components/FiltersPanel.test.tsx`
- **Integration Tests**: Cypress in `tests/integration/filters/ClearFilters.cy.tsx`
- **E2E Tests**: Cypress in `cypress/e2e/user-flows/filtering.cy.ts`
- Coverage: Button visibility, reset logic, URL clear, a11y announcements
- Test Data: Penguins with active filters (multi-species + island + sex)

### Accessibility Requirements

**Source: [docs/architecture/component-architecture.md#accessibility]**

- WCAG 2.1 AA: aria-live for announcements on reset
- Keyboard: Button focusable, Enter/Space activates
- Screen reader: Label "Clear X filters", post-reset "All filters cleared"

### Performance Considerations

**Source: [Previous Insights]**

- Reset triggers full re-render; use memoization from filtering.ts
- No debouncing needed; immediate reset

## Change Log

| Date       | Version | Description                  | Author             |
| ---------- | ------- | ---------------------------- | ------------------ |
| 2025-09-11 | 1.0     | Story drafted from PRD US2.4 | Bob (Scrum Master) |

## Dev Agent Record

### Agent Model Used

_To be filled by Dev Agent_

### Debug Log References

_To be filled by Dev Agent_

### Completion Notes List

_To be filled by Dev Agent_

### File List

_To be filled by Dev Agent_

## QA Results

### Review Date: 

### Reviewed By: 

_To be filled by QA Agent_