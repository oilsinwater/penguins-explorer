# Story 3.1: Explore with Scatter Plots

## Status

Draft

## Story

**As a** user,  
**I want** to explore relationships between different measurements with scatter plots,  
**so that** I can visually identify trends, correlations, and outliers in the penguin data.

_Part of Epic 3: Data Visualization from PRD (docs/prd.md section on exploration features)._

## Acceptance Criteria

1. X/Y axis dropdowns allow selection of any numeric column for the axes.
2. Points on the scatter plot are colored by species, using the standard project palette.
3. Hovering over a point displays a tooltip with the exact values and penguin details.
4. A legend is present to identify the colors associated with each species.
5. The legend is interactive, allowing the user to toggle the visibility of species on the plot.
6. The chart is responsive and resizes appropriately for different screen sizes, with minimum and maximum dimensions.
7. The chart includes alternative text that describes the visualization for screen reader users.

## Dev Notes

### UI Component Specifications

[Source: docs/architecture/component-architecture.md, docs/architecture/key-implementations.md]

- **`VisualizationPanel.tsx`**: Main container for the chart and controls.
- **`ChartTypeSelector.tsx`**: Handles switching to scatter plot view. Route: `/visualize/scatter`.
- **`AxisControls.tsx`**: New component with two MUI `Select` dropdowns for X/Y axes. Options: numeric fields (e.g., `bill_length_mm`, `bill_depth_mm`, `flipper_length_mm`, `body_mass_g`).
- **`ScatterPlot.tsx`**: New component rendering SVG scatter plot using D3.js (per key-implementations.md). Props: filtered data, axis config.
- **`ChartLegend.tsx`**: New interactive legend for species colors; toggles visibility.

### State Management Requirements

[Source: docs/architecture/state-management.md]

- Use `getFilteredPenguins` selector from `selectors.ts`.
- X/Y axes managed via URL params.
- Species visibility: local state in `ChartLegend.tsx`, filters data to D3.

### Routing Integration

[Source: docs/architecture/routing.md]

- Route: `/visualize/scatter`.
- URL params: `?x=bill_length_mm&y=body_mass_g`.
- `VisualizationRoute.tsx` parses params, passes to components; updates URL on changes.

### Data Flow

[Source: docs/architecture/data-flow.md]

1. Navigate to `/visualize/scatter`.
2. `VisualizationRoute.tsx` mounts, applies URL filters.
3. `getFilteredPenguins` provides data.
4. Parse X/Y from URL (defaults if none).
5. Pass data/axis to `ScatterPlot.tsx`.
6. Axis change in `AxisControls.tsx` → URL update → re-render.
7. Legend toggle → local filter → D3 update.

### File Structure Requirements

[Source: docs/architecture/source-tree.md]

- `src/components/visualizations/charts/ScatterPlot.tsx`
- `src/components/visualizations/AxisControls.tsx`
- `src/components/visualizations/ChartLegend.tsx`
- Update `src/components/visualizations/VisualizationPanel.tsx`.
- Update `src/routes/VisualizationRoute.tsx`.

### Testing Requirements

[Source: docs/architecture/testing-strategy.md]

- **Unit (Vitest + RTL)**: Dropdown rendering/callbacks (`AxisControls`), legend toggles (`ChartLegend`), D3 mock (`ScatterPlot`).
- **Integration (Cypress Component)**: Interactions in `VisualizationPanel`.
- **E2E (Cypress)**: Full flow (navigate, change axes, hover, toggle legend).
- **Accessibility (axe-core)**: ARIA labels, keyboard nav.

### Performance Considerations

[Source: docs/architecture/performance.md]

- Lazy-load `ScatterPlot.tsx`.
- Memoize data transforms for D3.
- Use D3 data-binding for efficient updates.

## Tasks / Subtasks

- [ ] **Task 1: Create AxisControls Component** (AC: 1)

  - [ ] Create `src/components/visualizations/AxisControls.tsx`.
  - [ ] Implement MUI `Select` for X/Y.
  - [ ] Populate with numeric fields.
  - [ ] Props: current X/Y, `onAxisChange` callback.

- [ ] **Task 2: Create ChartLegend Component** (AC: 4, 5)

  - [ ] Create `src/components/visualizations/ChartLegend.tsx`.
  - [ ] Display species/colors from theme.
  - [ ] Click to toggle visibility.
  - [ ] Local state for visible species.

- [ ] **Task 3: Create ScatterPlot Component** (AC: 2, 3, 6, 7)

  - [ ] Create `src/components/visualizations/charts/ScatterPlot.tsx`.
  - [ ] Render SVG with D3.js.
  - [ ] Props: data, axes, visible species.
  - [ ] Color by species.
  - [ ] Hover tooltips with details.
  - [ ] Responsive design.
  - [ ] ARIA labels/description.

- [ ] **Task 4: Integrate Components in VisualizationRoute**

  - [ ] Update `src/routes/VisualizationRoute.tsx` for `chartType === 'scatter'`.
  - [ ] Render `AxisControls`, `ChartLegend`, `ScatterPlot`.
  - [ ] Manage visible species state.
  - [ ] Parse/update URL for axes.

- [ ] **Task 5: Testing**
  - [ ] Unit tests for all new components.
  - [ ] Integration test for `VisualizationPanel`.
  - [ ] E2E test for scatter flow.
  - [ ] Accessibility tests.

## File List

- `src/components/visualizations/AxisControls.tsx`
- `src/components/visualizations/AxisControls.test.tsx`
- `src/components/visualizations/ChartLegend.tsx`
- `src/components/visualizations/ChartLegend.test.tsx`
- `src/components/visualizations/charts/ScatterPlot.tsx`
- `src/components/visualizations/charts/ScatterPlot.test.tsx`
- Updates to `src/components/visualizations/VisualizationPanel.tsx`
- Updates to `src/routes/VisualizationRoute.tsx`
- New E2E: `cypress/e2e/user-flows/scatter-plot.cy.ts`

## QA Results

### Review Date: [Pending]

### Reviewed By: [Pending]

### Gate Status: [Pending] → docs/qa/gates/3.data-viz-3.1-scatter-plots.yml

## Dev Agent Record

### Debug Log References: [None]

### Completion Notes: [None]

### Change Log: [None]
