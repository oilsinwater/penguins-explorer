# Story 3.2: See Distributions with Histograms

## Status

Ready for Development

## Story

**As a** user,
**I want** to see distributions of penguin measurements with histograms,
**so that** I can understand the frequency distribution and range of values for different species.

_Part of Epic 3: Data Visualization from PRD (docs/prd/user-stories-acceptance-criteria.md)._

## Acceptance Criteria

1. Dropdown allows selection of any numeric variable (bill_length_mm, bill_depth_mm, flipper_length_mm, body_mass_g).
2. Species are shown as overlapping distributions with clear visual distinction.
3. Adjustable bin size control with options for 5, 10, and 20 bins.
4. Y-axis shows count of observations.
5. Clear color/pattern distinction for different species using project palette.
6. Responsive sizing with appropriate dimensions for different screen sizes.
7. Alternative text describes the histogram for accessibility.

## Dev Notes

### UI Component Specifications

- **`VisualizationPanel.tsx`**: Update to handle histogram chart type.
- **`ChartTypeSelector.tsx`**: Add histogram option. Route: `/visualize/histogram`.
- **`HistogramControls.tsx`**: New component with variable dropdown and bin size selector.
- **`Histogram.tsx`**: New component rendering SVG histogram using D3.js with overlapping species distributions.

### State Management Requirements

- Use `getFilteredPenguins` selector from `selectors.ts`.
- Variable selection managed via URL params.
- Bin size: local state in `HistogramControls.tsx`, passed to D3.

### Routing Integration

- Route: `/visualize/histogram`.
- URL params: `?variable=bill_length_mm&bins=10`.
- `VisualizationRoute.tsx` parses params, passes to components.

### Data Flow

1. Navigate to `/visualize/histogram`.
2. `VisualizationRoute.tsx` mounts, applies URL filters.
3. `getFilteredPenguins` provides data.
4. Parse variable/bins from URL (defaults if none).
5. Pass data/config to `Histogram.tsx`.
6. Variable change in `HistogramControls.tsx` → URL update → re-render.

### File Structure Requirements

- `src/components/visualizations/charts/Histogram.tsx`
- `src/components/visualizations/HistogramControls.tsx`
- Update `src/components/visualizations/VisualizationPanel.tsx`.
- Update `src/routes/VisualizationRoute.tsx`.

### Testing Requirements

- **Unit (Vitest + RTL)**: Variable dropdown, bin size selector, D3 histogram rendering.
- **Integration (Cypress Component)**: Interactions in `VisualizationPanel`.
- **E2E (Cypress)**: Full flow (navigate, change variable, adjust bins).
- **Accessibility (axe-core)**: ARIA labels, keyboard navigation.

### Performance Considerations

- Lazy-load `Histogram.tsx`.
- Memoize histogram calculations for D3.
- Use D3 data-binding for efficient updates when bins change.

## Tasks / Subtasks

- [ ] **Task 1: Create HistogramControls Component** (AC: 1, 3)
  - [ ] Create `src/components/visualizations/HistogramControls.tsx`.
  - [ ] Implement MUI `Select` for variable selection.
  - [ ] Add bin size radio buttons (5, 10, 20).
  - [ ] Props: current variable/bins, `onConfigChange` callback.

- [ ] **Task 2: Create Histogram Component** (AC: 2, 4, 5, 6, 7)
  - [ ] Create `src/components/visualizations/charts/Histogram.tsx`.
  - [ ] Render SVG with D3.js histogram layout.
  - [ ] Props: data, variable, bins, species colors.
  - [ ] Overlapping species distributions.
  - [ ] Y-axis count labeling.
  - [ ] Responsive design with appropriate dimensions.
  - [ ] ARIA labels/description.

- [ ] **Task 3: Integrate Components in VisualizationRoute**
  - [ ] Update `src/routes/VisualizationRoute.tsx` for `chartType === 'histogram'`.
  - [ ] Render `HistogramControls`, `Histogram`.
  - [ ] Parse/update URL for variable and bins.

- [ ] **Task 4: Testing**
  - [ ] Unit tests for all new components.
  - [ ] Integration test for `VisualizationPanel`.
  - [ ] E2E test for histogram flow.
  - [ ] Accessibility tests.

## File List

- `src/components/visualizations/HistogramControls.tsx`
- `src/components/visualizations/HistogramControls.test.tsx`
- `src/components/visualizations/charts/Histogram.tsx`
- `src/components/visualizations/charts/Histogram.test.tsx`
- `src/components/visualizations/VisualizationPanel.tsx` (updated)
- `src/routes/VisualizationRoute.tsx` (updated)
- `cypress/e2e/user-flows/histogram.cy.ts`

## Status

Ready for Development
