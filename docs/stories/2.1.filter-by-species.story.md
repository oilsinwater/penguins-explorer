# Story 2.1: Filter Penguins by Species

## Status

Ready

## Story

**As a** user,  
**I want** to filter penguins by species,  
**so that** I can focus on specific penguin species in the dataset.

## Acceptance Criteria

1. Three checkboxes: Adelie, Chinstrap, Gentoo
2. All selected by default
3. Updates affect table and all visualizations
4. Filter state reflected in URL
5. Keyboard navigable checkboxes
6. Screen reader announces selection changes

## Tasks / Subtasks

- [ ] **Task 1: Implement Checkbox Filter Component** (AC: 1, 5, 6)

  - [ ] Create `src/components/filters/SpeciesFilter.tsx`
  - [ ] Implement keyboard-navigable checkbox group
  - [ ] Add ARIA labels for screen reader announcements
  - [ ] Ensure WCAG 2.1 compliance

- [ ] **Task 2: Connect Filter to State Management** (AC: 2, 3)

  - [ ] Update `src/stores/filterStore.ts` with species state
  - [ ] Implement default 'all selected' behavior
  - [ ] Add state persistence to URL using `@tanstack/react-router`

- [ ] **Task 3: Apply Filtering Logic** (AC: 3)

  - [ ] Modify `src/utils/filtering.ts` to handle species filtering
  - [ ] Ensure real-time updates across all data views
  - [ ] Test with all visualization components (requires Epic 3 completion)

- [ ] **Task 4: Testing Implementation**
  - [ ] Write Vitest unit tests for checkbox interactions
  - [ ] Write Cypress E2E tests for URL state persistence
  - [ ] Test keyboard navigation workflows
  - [ ] Validate screen reader announcements with axe-core

## Dev Notes

### UI Component Specifications

**Source: [architecture/tech-stack.md#ui-framework]**

- Use MUI v5 Checkbox component (@mui/material)
- Follow WCAG 2.1 focus states (3px outline)
- Group with `role="group"` and `aria-labelledby`

### State Management Requirements

**Source: [architecture/tech-stack.md#state-management]**

- React Context for filter state
- Synchronize with URL via `useSearchParams`
- Debounce rapid state updates

### File Structure Requirements

**Source: [architecture/source-tree.md]**

```
src/
└── components/
    └── filters/
        └── SpeciesFilter.tsx  # Main filter component with Emotion styling
```

### Testing Requirements

**Source: [architecture/testing-strategy.md]**

- **Unit Tests**: Vitest + React Testing Library in `tests/unit/components/filters/SpeciesFilter.test.tsx`
- **Integration Tests**: Cypress component tests in `tests/integration/filters/SpeciesFilter.cy.tsx`
- **E2E Tests**: Cypress E2E tests in `tests/e2e/user-flows/filtering.cy.ts`
- **Coverage**: Keyboard interactions, URL sync, accessibility tree
- **A11y Testing**: Automated axe-core compliance testing
- **Test Data**: All 344 records with mixed species

## Change Log

| Date       | Version | Description                                                     | Author   |
| ---------- | ------- | --------------------------------------------------------------- | -------- |
| 2024-09-04 | 1.0     | Story created from PRD US2.1                                    | BMad SM  |
| 2025-09-09 | 1.1     | Fixed technology references and added missing template sections | Sarah PO |

## Dev Agent Record

This section is populated by the development agent during implementation.

### Agent Model Used

_To be populated during implementation_

### Debug Log References

_To be populated during implementation_

### Completion Notes List

_To be populated during implementation_

### File List

_To be populated during implementation_

## QA Results

### Review Date: 2025-09-09

### Reviewed By: Quinn (Test Architect)

**Implementation Analysis:**

- ✅ **Component Structure**: SpeciesFilter.tsx created with MUI checkbox group
- ✅ **Keyboard Navigation**: Implemented with proper ARIA labels and key handlers
- ✅ **State Management**: filterStore.ts created with React Context
- ✅ **URL Persistence**: useFilterUrlSync hook implemented for TanStack Router
- ✅ **Filtering Logic**: filtering.ts utilities created with debounced updates

**Acceptance Criteria Coverage:**

1. ✅ Three checkboxes: Adelie, Chinstrap, Gentoo - **IMPLEMENTED**
2. ✅ All selected by default - **IMPLEMENTED**
3. ❓ Updates affect table and all visualizations - **NEEDS INTEGRATION TESTING**
4. ✅ Filter state reflected in URL - **IMPLEMENTED**
5. ✅ Keyboard navigable checkboxes - **IMPLEMENTED**
6. ✅ Screen reader announces selection changes - **IMPLEMENTED**

**Critical Gaps Identified:**

- **No unit tests** for SpeciesFilter component (high-severity requirement gap)
- **No E2E tests** for URL state persistence workflows
- **State integration disconnect** - component uses local state instead of store
- **Missing accessibility testing** with axe-core as specified
- **No integration with actual data visualizations** yet

### Gate Status

Gate: CONCERNS → docs/qa/gates/2.1-filter-by-species.yml
